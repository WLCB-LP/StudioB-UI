<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!--
    IMPORTANT:
    This UI is served as static files behind nginx.
    Browsers can aggressively cache index.html/app.js/styles.css, which can cause
    an operator to *appear* stuck on an older UI after an update.

    We deliberately ask the browser not to cache index.html so it can quickly
    discover the new cache-busted asset URLs after an update.
  -->
  <meta http-equiv="Cache-Control" content="no-store" />
  <title>WLCB • Studio B</title>
  <link rel="stylesheet" href="/styles.css?v=0.3.43" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand__title">WLCB • Studio B</div>
      <div class="brand__sub">Operator Console</div>
    </div>

    <nav class="tabs" aria-label="Pages">
      <button class="tab active" data-page="studio" aria-current="page">Studio</button>
      <button class="tab" data-page="engineering">Engineering</button>
    </nav>

    <div class="status">
      <div class="pill" id="connStatus">Connecting…</div>
      <!--
        Update pill:
        - ALWAYS visible as the operator's "jump to Engineering" shortcut.
        - Styling + tooltip change ONLY when an update is actually available.

        IMPORTANT:
        StudioB supports decoupled versioning (UI can update while engine is pinned).
        Therefore "update available" must be UI-version-based and must NOT be inferred
        from engine/runtime versions.
      -->
      <button class="pill pill--muted" id="updatePill" type="button" title="Check for updates">Update</button>
      <div class="pill pill--muted" id="uiVerPill">ui v—</div>
      <div class="pill pill--muted" id="verPill">engine v—</div>
      <div class="pill pill--muted" id="modePill">engine: —</div>
      <div class="pill pill--muted" id="dspConnPill">dsp: —</div>
      <div class="pill pill--muted" id="dspWritePill">dsp writes: —</div>
    </div>
  </header>

  <!-- Engineering unlock modal -->
  <div class="modal hidden" id="pinModal" role="dialog" aria-modal="true" aria-labelledby="pinTitle">
    <div class="modal__panel">
      <h2 id="pinTitle">Engineering Unlock</h2>
      <p class="muted">Enter the admin PIN to access Engineering controls.</p>
      <div class="row">
        <input class="text" id="pinInput" type="password" placeholder="Admin PIN" autocomplete="current-password" />
      </div>
      <div class="row row--right">
        <button class="btn" id="btnPinCancel">Cancel</button>
        <button class="btn ok" id="btnPinUnlock">Unlock</button>
      </div>
      <div class="small" id="pinMsg"></div>
    </div>
  </div>

  <main>
    <section id="page-studio" class="page">
      <div class="studioLayout">
        <!--
          Mixer (UI v0.3.20)

          DESIGN CONTRACT (operator intent only):
          - No automation modes (no AUTO, no hidden state)
          - One authoritative button per mic channel: MUTE
          - Faders are touch-first. We are enabling "real" gain writes one channel
            at a time for safety. In v0.3.19 only the Host fader is LIVE.

          Phase plan:
          - v0.3.14: multitouch-style fader lanes + RC-backed MUTE buttons.
          - v0.3.15: blue neon visual skin pass (no behavior changes).
          - v0.3.16: tactile polish (grabby faders, neon MUTE states, clearer reference marks).
          - v0.3.17: polish: stronger fader glow + MUTE uses color-only state (no "ON" text) with dim fill + bright border.
          - v0.3.18: polish: brighter muted neon red border + slightly brighter live green fill (visual-only).
          - v0.3.20: Installer/update self-repairs rc_allowlist to include fader RCs 101–110.
          - v0.3.19: Host fader now writes gain to RC 101 (phased rollout).
          - later: bind additional faders (RC 102–110) when ready.
        -->
        <!-- Mixer (UI v0.3.27)

          Expansion: add source faders as requested.
          - CD1 + CD2 grouped together (like microphones)
          - AUX, Bluetooth, PC, Zoom each get their own card

          Operator intent contract unchanged:
          - MUTE buttons are still the only live operator action for mic channels.
          - Faders remain visual-only except Host (phased rollout).
          - Mixer root remains hidden until hydrated (no flash positions).
        -->

        <!--
          Studio faders (UI v0.3.38)

          New layout request:
            1) Remove the lower panels and treat the Studio page as a
               dedicated "fader console".
            2) Keep the primary mic/source faders on the *bottom*.
            3) Add a NEW top fader row for:
                 PIL | Headphones | Speakers | Program

          IMPORTANT SAFETY/CONTINUITY CONTRACT:
          - DSP/engine remain the source of truth.
          - Both fader rows remain hidden until we receive an authoritative
            RC snapshot.
        -->

        <!-- Top fader row (visibility + future wiring) -->
        <div class="studioTopFaders">
          <div class="mixerRoot mixerRoot--top isHydrating" id="topMixerRoot">

            <!-- PIL (placeholder – no controls yet) -->
            <div class="card mixerCard mixerCard--placeholder">
              <div class="mixerCard__head"><div class="mixerCard__title">PIL</div></div>
              <div class="mixerRow mixerRow--1">
                <div class="strip strip--placeholder" data-strip="pil">
                  <div class="strip__title">PIL</div>
                  <div class="fader fader--placeholder">
                    <div class="fader__lane fader__lane--placeholder" aria-hidden="true">
                      <div class="fader__meterPair" aria-hidden="true">
                        <div class="fader__meter fader__meter--L"></div>
                        <div class="fader__meter fader__meter--R"></div>
                      </div>
                      <div class="fader__marks" aria-hidden="true">
                        <div class="fader__mark fader__mark--major fader__mark--zero" style="top:0%"><span>0</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:10%"><span>-3</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:20%"><span>-6</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark fader__mark--major fader__mark--ref" style="top:40%"><span>-12</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:65%"><span>-20</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:80%"><span>-30</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark fader__mark--major" style="top:100%"><span>-∞</span><div class="fader__markLine"></div></div>
                      </div>
                    </div>
                  </div>
                  <div class="strip__actions strip__actions--empty"></div>
                </div>
              </div>
            </div>

            <!-- Headphones (placeholder – no fader or mute assigned yet) -->
            <div class="card mixerCard mixerCard--placeholder">
              <div class="mixerCard__head"><div class="mixerCard__title">Headphones</div></div>
              <div class="mixerRow mixerRow--1">
                <div class="strip strip--placeholder" data-strip="hp">
                  <div class="strip__title">Headphones</div>
                  <div class="fader fader--placeholder">
                    <div class="fader__lane fader__lane--placeholder" aria-hidden="true">
                      <div class="fader__meterPair" aria-hidden="true">
                        <div class="fader__meter fader__meter--L"></div>
                        <div class="fader__meter fader__meter--R"></div>
                      </div>
                      <div class="fader__marks" aria-hidden="true">
                        <div class="fader__mark fader__mark--major fader__mark--zero" style="top:0%"><span>0</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:10%"><span>-3</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:20%"><span>-6</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark fader__mark--major fader__mark--ref" style="top:40%"><span>-12</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:65%"><span>-20</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:80%"><span>-30</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark fader__mark--major" style="top:100%"><span>-∞</span><div class="fader__markLine"></div></div>
                      </div>
                    </div>
                  </div>
                  <div class="strip__actions strip__actions--empty"></div>
                </div>
              </div>
            </div>

            <!-- Speakers (LIVE RC: 160 level, 161 mute) -->
            <div class="card mixerCard">
              <div class="mixerCard__head"><div class="mixerCard__title">Speakers</div></div>
              <div class="mixerRow mixerRow--1">
                <div class="strip" data-strip="spk">
                  <div class="strip__title">Speakers</div>
                  <div class="fader">
                    <div class="fader__lane" data-fader="spk" aria-label="Speakers fader (RC 160)" title="Speaker Level (RC 160)">
                      <div class="fader__meterPair" aria-hidden="true">
                        <div class="fader__meter fader__meter--L"></div>
                        <div class="fader__meter fader__meter--R"></div>
                      </div>
                      <div class="fader__marks" aria-hidden="true">
                        <div class="fader__mark fader__mark--major fader__mark--zero" style="top:0%"><span>0</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:10%"><span>-3</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:20%"><span>-6</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark fader__mark--major fader__mark--ref" style="top:40%"><span>-12</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:65%"><span>-20</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:80%"><span>-30</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark fader__mark--major" style="top:100%"><span>-∞</span><div class="fader__markLine"></div></div>
                      </div>
                      <div class="fader__puck" role="slider" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.65" tabindex="0"></div>
                    </div>
                  </div>
                  <div class="strip__actions">
                    <button class="woBtn woBtn--mute btn toggle" data-rc="161" title="Speaker Mute (RC 161)" aria-label="Speaker mute"></button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Program (placeholder – fader/mute to be wired later) -->
            <div class="card mixerCard mixerCard--placeholder">
              <div class="mixerCard__head"><div class="mixerCard__title">Program</div></div>
              <div class="mixerRow mixerRow--1">
                <div class="strip strip--placeholder" data-strip="pgm">
                  <div class="strip__title">Program</div>
                  <div class="fader fader--placeholder">
                    <div class="fader__lane fader__lane--placeholder" aria-hidden="true">
                      <div class="fader__meterPair" aria-hidden="true">
                        <div class="fader__meter fader__meter--L"></div>
                        <div class="fader__meter fader__meter--R"></div>
                      </div>
                      <div class="fader__marks" aria-hidden="true">
                        <div class="fader__mark fader__mark--major fader__mark--zero" style="top:0%"><span>0</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:10%"><span>-3</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:20%"><span>-6</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark fader__mark--major fader__mark--ref" style="top:40%"><span>-12</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:65%"><span>-20</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark" style="top:80%"><span>-30</span><div class="fader__markLine"></div></div>
                        <div class="fader__mark fader__mark--major" style="top:100%"><span>-∞</span><div class="fader__markLine"></div></div>
                      </div>
                    </div>
                  </div>
                  <div class="strip__actions strip__actions--empty"></div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- Bottom fader row (mics + sources) -->
        <div class="studioBottomFaders">
          <!--
            v0.3.42: The bottom fader row is the *primary* operator console.
            We tag it with a dedicated class so we can make bottom-row-only
            spacing adjustments (ex: align Zoom to the right edge) without
            affecting the top row or any future engineering views.
          -->
          <div class="mixerRoot mixerRoot--bottom isHydrating" id="mixerRoot">
          <!--
            Mixer grouping layout (UI v0.3.34)

            Operator requirement (no scrolling / no vertical stacking):

              | Mic Mic Mic Mic |     (flex gap)     | CD1 CD2 |     (flex gap)     | AUX |
              |     (flex gap)     | BT |     (flex gap)     | PC Zoom |

            Implementation notes:
            - Each group is a "solid" block (flex:0 0 auto; flex-wrap:nowrap).
            - Between groups we insert .mixerSpacer elements that expand to
              consume extra horizontal space.
            - Spacers are allowed to shrink toward 0 if needed, but we do NOT
              scroll and we do NOT wrap strips vertically.
          -->
          <div class="mixerGroup mixerGroup--mics">
          <!-- Microphones (grouped) -->
          <div class="card mixerCard">
            <div class="mixerCard__head"><div class="mixerCard__title">Microphones</div></div>
            <div class="mixerRow mixerRow--4">

            <div class="strip" data-strip="host">
              <div class="strip__title strip__title--host">Host</div>
              <div class="fader">
                <div class="fader__lane" data-fader="host" aria-label="Host fader (RC 101)" title="Host Mic Level (RC 101)">
                  <div class="fader__meter"></div>
                  <div class="fader__marks" aria-hidden="true">
                    <div class="fader__mark fader__mark--major fader__mark--zero" style="top:0%"><span>0</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:10%"><span>-3</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:20%"><span>-6</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major fader__mark--ref" style="top:40%"><span>-12</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:65%"><span>-20</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:80%"><span>-30</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major" style="top:100%"><span>-∞</span><div class="fader__markLine"></div></div>
                  </div>
                  <div class="fader__puck" role="slider" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.65" tabindex="0"></div>
                </div>
              </div>
              <div class="strip__actions">
                <button class="woBtn woBtn--mute btn toggle" data-rc="121" title="Host Mic Mute (RC 121)" aria-label="Host mic mute">
                  
                </button>
              </div>
            </div>

            <div class="strip" data-strip="g1">
              <div class="strip__title">Guest 1</div>
              <div class="fader">
                <div class="fader__lane" data-fader="g1" aria-label="Guest 1 fader (visual only)" title="Guest 1 Mic Level (RC 102) – visual only">
                  <div class="fader__meter"></div>
                  <div class="fader__marks" aria-hidden="true">
                    <div class="fader__mark fader__mark--major fader__mark--zero" style="top:0%"><span>0</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:10%"><span>-3</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:20%"><span>-6</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major fader__mark--ref" style="top:40%"><span>-12</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:65%"><span>-20</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:80%"><span>-30</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major" style="top:100%"><span>-∞</span><div class="fader__markLine"></div></div>
                  </div>
                  <div class="fader__puck" role="slider" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.65" tabindex="0"></div>
                </div>
              </div>
              <div class="strip__actions">
                <button class="woBtn woBtn--mute btn toggle" data-rc="122" title="Guest Mic 1 Mute (RC 122)" aria-label="Guest 1 mic mute">
                  
                </button>
              </div>
            </div>

            <div class="strip" data-strip="g2">
              <div class="strip__title">Guest 2</div>
              <div class="fader">
                <div class="fader__lane" data-fader="g2" aria-label="Guest 2 fader (visual only)" title="Guest 2 Mic Level (RC 103) – visual only">
                  <div class="fader__meter"></div>
                  <div class="fader__marks" aria-hidden="true">
                    <div class="fader__mark fader__mark--major fader__mark--zero" style="top:0%"><span>0</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:10%"><span>-3</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:20%"><span>-6</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major fader__mark--ref" style="top:40%"><span>-12</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:65%"><span>-20</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:80%"><span>-30</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major" style="top:100%"><span>-∞</span><div class="fader__markLine"></div></div>
                  </div>
                  <div class="fader__puck" role="slider" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.65" tabindex="0"></div>
                </div>
              </div>
              <div class="strip__actions">
                <button class="woBtn woBtn--mute btn toggle" data-rc="123" title="Guest Mic 2 Mute (RC 123)" aria-label="Guest 2 mic mute">
                  
                </button>
              </div>
            </div>

            <div class="strip" data-strip="g3">
              <div class="strip__title">Guest 3</div>
              <div class="fader">
                <div class="fader__lane" data-fader="g3" aria-label="Guest 3 fader (visual only)" title="Guest 3 Mic Level (RC 104) – visual only">
                  <div class="fader__meter"></div>
                  <div class="fader__marks" aria-hidden="true">
                    <div class="fader__mark fader__mark--major fader__mark--zero" style="top:0%"><span>0</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:10%"><span>-3</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:20%"><span>-6</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major fader__mark--ref" style="top:40%"><span>-12</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:65%"><span>-20</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:80%"><span>-30</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major" style="top:100%"><span>-∞</span><div class="fader__markLine"></div></div>
                  </div>
                  <div class="fader__puck" role="slider" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.65" tabindex="0"></div>
                </div>
              </div>
              <div class="strip__actions">
                <button class="woBtn woBtn--mute btn toggle" data-rc="124" title="Guest Mic 3 Mute (RC 124)" aria-label="Guest 3 mic mute">
                  
                </button>
              </div>
            </div>
            </div>
          </div>
          </div>

          <div class="mixerSpacer" aria-hidden="true"></div>
          <div class="mixerGroup mixerGroup--cd">

          

          <!-- CD Players (grouped) -->
          <div class="card mixerCard">
            <div class="mixerCard__head"><div class="mixerCard__title">CD Players</div></div>
            <div class="mixerRow mixerRow--2">

              <div class="strip" data-strip="cd1">
                <div class="strip__title">CD1</div>
                <div class="fader">
                  <div class="fader__lane" data-fader="cd1" aria-label="CD1 fader (visual only)" title="CD1 Level (RC 105) – visual only">
                    <!--
                      Stereo dual-VU enhancement (UI v0.3.32)

                      Stereo sources in Studio B have separate L/R meters in the DSP
                      (e.g. CD1 uses RC 405/406).

                      The UI does not yet have real per-channel level readback
                      behind these lanes (the meter is a visual placeholder), but
                      operators still benefit from the correct *shape*:
                      - Mono inputs (mics) show one meter bar.
                      - Stereo inputs show two meter bars (L + R).

                      When we later wire per-channel meter values, these two bars
                      will be driven independently.
                    -->
                    <div class="fader__meterPair" aria-hidden="true">
                      <div class="fader__meter fader__meter--L"></div>
                      <div class="fader__meter fader__meter--R"></div>
                    </div>
                    <div class="fader__marks" aria-hidden="true">
                    <div class="fader__mark fader__mark--major fader__mark--zero" style="top:0%"><span>0</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:10%"><span>-3</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:20%"><span>-6</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major fader__mark--ref" style="top:40%"><span>-12</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:65%"><span>-20</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:80%"><span>-30</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major" style="top:100%"><span>-∞</span><div class="fader__markLine"></div></div>
                  </div>
                    <div class="fader__puck" role="slider" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.65" tabindex="0"></div>
                  </div>
                </div>
              <div class="strip__actions">
                <button class="woBtn woBtn--mute btn toggle" data-rc="125" title="CD1 Mute (RC 125)" aria-label="cd1 mute"></button>
              </div>
              </div>

              <div class="strip" data-strip="cd2">
                <div class="strip__title">CD2</div>
                <div class="fader">
                  <div class="fader__lane" data-fader="cd2" aria-label="CD2 fader (visual only)" title="CD2 Level (RC 106) – visual only">
                    <div class="fader__meterPair" aria-hidden="true">
                      <div class="fader__meter fader__meter--L"></div>
                      <div class="fader__meter fader__meter--R"></div>
                    </div>
                    <div class="fader__marks" aria-hidden="true">
                    <div class="fader__mark fader__mark--major fader__mark--zero" style="top:0%"><span>0</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:10%"><span>-3</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:20%"><span>-6</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major fader__mark--ref" style="top:40%"><span>-12</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:65%"><span>-20</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:80%"><span>-30</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major" style="top:100%"><span>-∞</span><div class="fader__markLine"></div></div>
                  </div>
                    <div class="fader__puck" role="slider" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.65" tabindex="0"></div>
                  </div>
                </div>
              <div class="strip__actions">
                <button class="woBtn woBtn--mute btn toggle" data-rc="126" title="CD2 Mute (RC 126)" aria-label="cd2 mute"></button>
              </div>
              </div>
            </div>
          </div>

          </div>

          <div class="mixerSpacer" aria-hidden="true"></div>
          <div class="mixerGroup mixerGroup--aux">

          <!-- Single-source cards -->
          <div class="card mixerCard">
            <div class="mixerCard__head"><div class="mixerCard__title">AUX</div></div>
            <div class="mixerRow mixerRow--1">

              <div class="strip" data-strip="aux">
                <div class="strip__title">AUX</div>
                <div class="fader">
                  <div class="fader__lane" data-fader="aux" aria-label="AUX fader (visual only)" title="AUX Level (RC 107) – visual only">
                    <div class="fader__meterPair" aria-hidden="true">
                      <div class="fader__meter fader__meter--L"></div>
                      <div class="fader__meter fader__meter--R"></div>
                    </div>
                    <div class="fader__marks" aria-hidden="true">
                    <div class="fader__mark fader__mark--major fader__mark--zero" style="top:0%"><span>0</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:10%"><span>-3</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:20%"><span>-6</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major fader__mark--ref" style="top:40%"><span>-12</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:65%"><span>-20</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:80%"><span>-30</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major" style="top:100%"><span>-∞</span><div class="fader__markLine"></div></div>
                  </div>
                    <div class="fader__puck" role="slider" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.65" tabindex="0"></div>
                  </div>
                </div>
              <div class="strip__actions">
                <button class="woBtn woBtn--mute btn toggle" data-rc="127" title="AUX Mute (RC 127)" aria-label="aux mute"></button>
              </div>
              </div>
            </div>
          </div>

          </div>

          <div class="mixerSpacer" aria-hidden="true"></div>
          <div class="mixerGroup mixerGroup--bt">

          <div class="card mixerCard">
            <div class="mixerCard__head"><div class="mixerCard__title">Bluetooth</div></div>
            <div class="mixerRow mixerRow--1">

              <div class="strip" data-strip="bt">
                <div class="strip__title">BT</div>
                <div class="fader">
                  <div class="fader__lane" data-fader="bt" aria-label="BT fader (visual only)" title="BT Level (RC 108) – visual only">
                    <div class="fader__meterPair" aria-hidden="true">
                      <div class="fader__meter fader__meter--L"></div>
                      <div class="fader__meter fader__meter--R"></div>
                    </div>
                    <div class="fader__marks" aria-hidden="true">
                    <div class="fader__mark fader__mark--major fader__mark--zero" style="top:0%"><span>0</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:10%"><span>-3</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:20%"><span>-6</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major fader__mark--ref" style="top:40%"><span>-12</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:65%"><span>-20</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:80%"><span>-30</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major" style="top:100%"><span>-∞</span><div class="fader__markLine"></div></div>
                  </div>
                    <div class="fader__puck" role="slider" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.65" tabindex="0"></div>
                  </div>
                </div>
              <div class="strip__actions">
                <button class="woBtn woBtn--mute btn toggle" data-rc="128" title="Bluetooth Mute (RC 128)" aria-label="bt mute"></button>
              </div>
              </div>
            </div>
          </div>

          </div>

          <div class="mixerSpacer" aria-hidden="true"></div>
          <!--
            v0.3.43: PC and Zoom MUST be separated by the same spacing logic
            as all other bottom-row inter-group gaps.

            In v0.3.42, PC+Zoom lived inside a single flex group that used a
            fixed `gap:` token. Meanwhile, the *spacer* elements between other
            groups were allowed to grow on the bottom row to reach the right
            edge alignment. The visual result was a slightly narrower PC↔Zoom
            gap compared to the other expanded gaps.

            Fix: treat PC and Zoom as two normal groups with a normal spacer
            between them so the bottom-row "grow equally" rule applies.
          -->
          <div class="mixerGroup mixerGroup--pc">

          <div class="card mixerCard">
            <div class="mixerCard__head"><div class="mixerCard__title">PC</div></div>
            <div class="mixerRow mixerRow--1">

              <div class="strip" data-strip="pc">
                <div class="strip__title">PC</div>
                <div class="fader">
                  <div class="fader__lane" data-fader="pc" aria-label="PC fader (visual only)" title="PC Level (RC 109) – visual only">
                    <div class="fader__meterPair" aria-hidden="true">
                      <div class="fader__meter fader__meter--L"></div>
                      <div class="fader__meter fader__meter--R"></div>
                    </div>
                    <div class="fader__marks" aria-hidden="true">
                    <div class="fader__mark fader__mark--major fader__mark--zero" style="top:0%"><span>0</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:10%"><span>-3</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:20%"><span>-6</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major fader__mark--ref" style="top:40%"><span>-12</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:65%"><span>-20</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:80%"><span>-30</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major" style="top:100%"><span>-∞</span><div class="fader__markLine"></div></div>
                  </div>
                    <div class="fader__puck" role="slider" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.65" tabindex="0"></div>
                  </div>
                </div>
              <div class="strip__actions">
                <button class="woBtn woBtn--mute btn toggle" data-rc="129" title="PC Audio Mute (RC 129)" aria-label="pc mute"></button>
              </div>
              </div>
            </div>
          </div>

          </div>

          <div class="mixerSpacer" aria-hidden="true"></div>
          <div class="mixerGroup mixerGroup--zoom">

          <div class="card mixerCard">
            <div class="mixerCard__head"><div class="mixerCard__title">Zoom</div></div>
            <div class="mixerRow mixerRow--1">

              <div class="strip" data-strip="zoom">
                <div class="strip__title">Zoom</div>
                <div class="fader">
                  <div class="fader__lane" data-fader="zoom" aria-label="Zoom fader (visual only)" title="Zoom Level (RC 110) – visual only">
                    <div class="fader__meterPair" aria-hidden="true">
                      <div class="fader__meter fader__meter--L"></div>
                      <div class="fader__meter fader__meter--R"></div>
                    </div>
                    <div class="fader__marks" aria-hidden="true">
                    <div class="fader__mark fader__mark--major fader__mark--zero" style="top:0%"><span>0</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:10%"><span>-3</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:20%"><span>-6</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major fader__mark--ref" style="top:40%"><span>-12</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:65%"><span>-20</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark" style="top:80%"><span>-30</span><div class="fader__markLine"></div></div>
                    <div class="fader__mark fader__mark--major" style="top:100%"><span>-∞</span><div class="fader__markLine"></div></div>
                  </div>
                    <div class="fader__puck" role="slider" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.65" tabindex="0"></div>
                  </div>
                </div>
              <div class="strip__actions">
                <button class="woBtn woBtn--mute btn toggle" data-rc="130" title="Zoom Audio Mute (RC 130)" aria-label="zoom mute"></button>
              </div>
              </div>
            </div>
          </div>

          </div>
          </div>
        </div>

        <!-- Close the bottom fader row wrapper -->
        </div>

        <!--
          UI v0.3.38:
          The Studio page is intentionally a dedicated fader console.
          The previous "panels" (speakers slider, DSP health, meters) were
          removed from this page to keep the console uncluttered.

          Those diagnostics remain available on the Engineering tab.
        -->
      </div>
    </section>

    <section id="page-engineering" class="page hidden">
      <h1 class="pageTitle">Engineering</h1>

      <div class="grid">
        <div class="card">
          <h2>Admin</h2>
          <div class="row">
            <input class="text" id="adminPin" type="password" placeholder="Admin PIN" autocomplete="current-password" />
          </div>
          <div class="row">
            <button class="btn warn" id="btnUpdate">Update (Release)</button>
            <button class="btn warn" id="btnRollback">Rollback…</button>
          </div>
          <div class="small" id="svcMsg"></div>
          <div class="small" id="updateCheckMsg"></div>

          <div class="row">
            <!--
              Update/rollback can legitimately require the operator to refresh the browser
              to pick up new cache-busted UI assets (index.html/app.js/styles.css).
              We keep this as an explicit operator action for production safety.
            -->
            <button class="btn ok hidden" id="btnRefresh">Refresh Now</button>
            <button class="btn hidden" id="btnSvcClear" title="Clear the message below">Clear</button>
          </div>

        </div>


        <div class="card">
          <h2>Configuration</h2>
          <!--
            Persisted vs runtime clarity (UI v0.3.07+)

            Operators frequently expect this panel to reflect *what is running right now*.
            In reality, this editor controls the persisted file on disk, which only fully
            takes effect after an engine restart (watchdog may restart automatically).

            Runtime mode may differ if the watchdog promoted/overrode the running engine
            without writing back to disk.
          -->
          <div class="small">Persisted config (applies on restart). Edits <code>~/.StudioB-UI/config/config.v1</code>.</div>
          <div class="small cfg-clarity">
            <span class="muted">Persisted:</span> <span id="cfgPersistedMode">—</span>
            <span class="muted">Runtime:</span> <span id="cfgRuntimeMode">—</span>
            <span class="pill pill--warn hidden" id="cfgRuntimeBadge">Runtime override active</span>
          </div>
          <div class="row">
            <label class="lbl">Mode</label>
            <select class="select" id="cfgMode">
              <option value="mock">mock (default)</option>
              <option value="live">live (reserved)</option>
            </select>
          </div>
          <div class="row">
            <label class="lbl">DSP IP</label>
            <input class="text" id="cfgDspIp" type="text" placeholder="e.g. 192.168.1.50" />
          </div>
          <div class="row">
            <label class="lbl">DSP Port</label>
            <input class="text" id="cfgDspPort" type="number" min="1" max="65535" placeholder="e.g. 48631" />
          </div>
          <div class="row">
            <button class="btn" id="btnCfgLoad">Load</button>
            <button class="btn warn" id="btnCfgSave">Save</button>
          </div>
          <div class="small" id="cfgMsg"></div>
        </div>

        <div class="card">
          <h2>Engine</h2>
          <pre id="engineInfo" class="pre">Loading…</pre>
        </div>

        <div class="card">
          <h2>Watchdog</h2>
          <div class="small" id="watchdogMsg">Loading…</div>
          <pre id="watchdogSystemd" class="pre">Loading…</pre>
          <div class="row">
            
<div class="wd-dsp" id="wdDspSummary">
  <div class="wd-dsp__title">DSP (summary)</div>
  <div class="kv"><span class="k">Mode</span><span class="v" id="wdDspMode">—</span></div>
          <div class="kv"><span class="k">Active</span><span class="v" id="wdDspActiveMode">—</span></div>
  <div class="kv"><span class="k">State</span><span class="v" id="wdDspState">—</span></div>
  <div class="kv"><span class="k">Last test</span><span class="v" id="wdDspLastTest">—</span></div>
  <div class="kv"><span class="k">Last poll</span><span class="v" id="wdDspLastPoll">—</span></div>
  <div class="kv"><span class="k">Failures</span><span class="v" id="wdDspFailures">—</span></div>
  <div class="kv"><span class="k">Validated</span><span class="v" id="wdDspValidated">—</span></div>
  <div class="kv"><span class="k">Last write</span><span class="v" id="wdDspLastWrite">—</span></div>
  <div class="kv"><span class="k">Config</span><span class="v" id="wdDspCfg">—</span></div>
  <div class="wd-dsp__err" id="wdDspErr" style="display:none;"></div>
</div>
<button class="btn" id="btnWatchdogStart">Start watchdog</button>

          </div>
        </div>

        <div class="card">
          <h2>Recent Runtime Events</h2>
          <!--
            UI-only runtime timeline (v0.3.12)

            This records observed state transitions since page load.
            It is intentionally:
              - read-only
              - in-memory only
              - bounded (last ~20 items)

            Purpose: give operators temporal context during troubleshooting
            (watchdog restarts, runtime overrides, connectivity changes, etc.).
          -->
          <div class="small muted">Since page load (UI-only). Helps explain restarts/overrides.</div>
          <pre id="runtimeEvents" class="pre">—</pre>
        </div>

        <div class="card">
          <h2>Debug Snapshot</h2>
          <pre id="stateDump" class="pre">Loading…</pre>
        </div>
      </div>
    </section>
  </main>

  <!-- Cache-buster: keep this in sync with VERSION so browsers pick up new JS after updates -->
  <script src="/app.js?v=0.3.43"></script>
</body>
</html>
